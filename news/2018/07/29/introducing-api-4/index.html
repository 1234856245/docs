<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Introducing API version 4 | Images.weserv.nl</title>
    <meta name="description" content="Image cache &amp; resize service">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#a72376">
  <meta name="msapplication-TileColor" content="#a72376">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.69005a48.css" as="style"><link rel="preload" href="/assets/js/app.46175f23.js" as="script"><link rel="preload" href="/assets/js/1.439f20f5.js" as="script"><link rel="preload" href="/assets/js/11.df7e7a8a.js" as="script"><link rel="preload" href="/assets/js/6.3fa32d31.js" as="script"><link rel="prefetch" href="/assets/js/10.178b86fc.js"><link rel="prefetch" href="/assets/js/12.a5216428.js"><link rel="prefetch" href="/assets/js/13.f177ac49.js"><link rel="prefetch" href="/assets/js/14.a282048d.js"><link rel="prefetch" href="/assets/js/15.bf0e76b0.js"><link rel="prefetch" href="/assets/js/16.e454ad79.js"><link rel="prefetch" href="/assets/js/17.dab4d9b0.js"><link rel="prefetch" href="/assets/js/18.b037ff9a.js"><link rel="prefetch" href="/assets/js/19.b8c480ce.js"><link rel="prefetch" href="/assets/js/20.4e018b4f.js"><link rel="prefetch" href="/assets/js/21.bc89c6d7.js"><link rel="prefetch" href="/assets/js/22.e88a2af0.js"><link rel="prefetch" href="/assets/js/23.cf703fdf.js"><link rel="prefetch" href="/assets/js/24.cc835774.js"><link rel="prefetch" href="/assets/js/25.ac84155b.js"><link rel="prefetch" href="/assets/js/4.81a94c11.js"><link rel="prefetch" href="/assets/js/5.808b43b6.js"><link rel="prefetch" href="/assets/js/7.5465e3dd.js"><link rel="prefetch" href="/assets/js/8.e9d06eba.js"><link rel="prefetch" href="/assets/js/9.2d73b35f.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.c5e9d014.js">
    <link rel="stylesheet" href="/assets/css/0.styles.69005a48.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Images.weserv.nl" class="logo"><span class="site-name can-hide">Images.weserv.nl</span></a><div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Documentation
</a></div><div class="nav-item"><a href="/faq/" class="nav-link">
  FAQ
</a></div><a href="https://github.com/weserv/images" target="_blank" rel="noopener noreferrer" class="repo-link">
    Feedback? GitHub!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://github.com/weserv/images" title="Feedback? GitHub!" aria-label="Feedback? GitHub!" target="_blank" rel="noopener noreferrer" class="github-corner"><svg width="57" height="57" viewBox="0 0 250 250" aria-hidden="true" style="position: fixed; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="#a72376"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="#fff" class="octo-arm" style="transform-origin: 130px 106px;"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="#fff" class="octo-body"></path></svg></a></nav></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Documentation
</a></div><div class="nav-item"><a href="/faq/" class="nav-link">
  FAQ
</a></div><a href="https://github.com/weserv/images" target="_blank" rel="noopener noreferrer" class="repo-link">
    Feedback? GitHub!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://github.com/weserv/images" title="Feedback? GitHub!" aria-label="Feedback? GitHub!" target="_blank" rel="noopener noreferrer" class="github-corner"><svg width="57" height="57" viewBox="0 0 250 250" aria-hidden="true" style="position: fixed; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="#a72376"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="#fff" class="octo-arm" style="transform-origin: 130px 106px;"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="#fff" class="octo-body"></path></svg></a></nav><ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Introducing API version 4</span><!----></p><ul class="sidebar-links sidebar-group-items"><li><a href="/news/2018/07/29/introducing-api-4/#preface" class="sidebar-link">Preface</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/news/2018/07/29/introducing-api-4/#openresty-luajit-and-lua-vips" class="sidebar-link">OpenResty, LuaJIT and lua-vips</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/news/2018/07/29/introducing-api-4/#what-has-changed-for-the-end-user" class="sidebar-link">What has changed for the end user?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/news/2018/07/29/introducing-api-4/#what-has-been-added" class="sidebar-link">What has been added?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/news/2018/07/29/introducing-api-4/#masking" class="sidebar-link">Masking</a></li><li class="sidebar-sub-header"><a href="/news/2018/07/29/introducing-api-4/#flexible-uri-parser" class="sidebar-link">Flexible URI parser</a></li></ul></li><li><a href="/news/2018/07/29/introducing-api-4/#where-can-i-view-the-code" class="sidebar-link">Where can I view the code?</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul></aside><main class="page"><div class="theme-default-content content__default"><h1 id="introducing-api-version-4"><a href="#introducing-api-version-4" class="header-anchor">#</a> Introducing API version 4</h1><h2 id="preface"><a href="#preface" class="header-anchor">#</a> Preface</h2><p>As the amount of traffic increases, we come up with solutions to handle the traffic. Nowadays we handle
2 million requests per hour (4 million on peak), which is great, but it requires proper server capacity and
effective software that scales with the amount of traffic that make this service reliable.</p><h2 id="openresty-luajit-and-lua-vips"><a href="#openresty-luajit-and-lua-vips" class="header-anchor">#</a> OpenResty, LuaJIT and lua-vips</h2><p>With API version 4 we decided to rewrite to complete code base to Lua and switch to <a href="https://openresty.org/en/" target="_blank" rel="noopener noreferrer">OpenResty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
which turns <a href="https://nginx.org/" target="_blank" rel="noopener noreferrer">nginx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://luajit.org/luajit.html" target="_blank" rel="noopener noreferrer">LuaJIT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> into a full-fledged scriptable web platform. For image handling and
manipulation we still use the <a href="https://github.com/libvips/libvips" target="_blank" rel="noopener noreferrer">libvips<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> image processing library under the hood. We have only moved
from the <a href="https://github.com/libvips/php-vips" target="_blank" rel="noopener noreferrer">PHP-binding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to the <a href="https://github.com/libvips/lua-vips" target="_blank" rel="noopener noreferrer">Lua binding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><p>You may wonder why we did this; it's because OpenResty is robust, fast and scales with the amount of
traffic we are processing nowadays. One of the core benefits of OpenResty is that it is fully asynchronous
and that our code can be written directly inside Nginx without using PHP-FPM and FastCGI. The amazing
just-in-time (JIT) compilation and the integrated foreign function interface (FFI) in LuaJIT have also been
motives to move away from PHP.</p><p>Perhaps you've already noticed, <a href="/" class="router-link-active">https://images.weserv.nl/</a> already states that API version 4 is
running. This is not a mistake, our A/B testing went so well that we decided (on time of writing) to
forward all traffic to API version 4.</p><h2 id="what-has-changed-for-the-end-user"><a href="#what-has-changed-for-the-end-user" class="header-anchor">#</a> What has changed for the end user?</h2><p>Absolutely nothing, all parameters listed on API 3 still work on API 4. The only thing you might notice is
when you process an image, that it will load faster. If you found something odd, don't hesitate to contact
us.</p><p>We track support tickets, issues and feature requests using the <a href="https://github.com/weserv/images/issues" target="_blank" rel="noopener noreferrer">GitHub issue tracker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p><h2 id="what-has-been-added"><a href="#what-has-been-added" class="header-anchor">#</a> What has been added?</h2><p>We introduced some new parameters and a more flexible URI parser.</p><h3 id="masking"><a href="#masking" class="header-anchor">#</a> Masking</h3><p>Controls the visible and non-visible area of the image. Previously the <a href="/docs/mask.html#mask-type"><code>&amp;mask</code></a> and <a href="/docs/mask.html#mask-trim"><code>&amp;mtrim</code></a> parameter
were named as <code>&amp;shape</code> and <code>&amp;strim</code>, it was renamed to make room for new mask features.</p><ul><li>Mask type <a href="/docs/mask.html#mask-type"><code>&amp;mask</code></a>. Sets the mask type from a predefined list of shapes:
<ul><li><code>circle</code></li><li><code>ellipse</code></li><li><code>triangle</code></li><li><code>triangle-180</code>: Triangle tilted upside down</li><li><code>pentagon</code></li><li><code>pentagon-180</code>: Pentagon tilted upside down</li><li><code>hexagon</code></li><li><code>square</code>: Square tilted 45 degrees</li><li><code>star</code>: 5-point star</li><li><code>heart</code></li></ul></li><li>Mask trim <a href="/docs/mask.html#mask-trim"><code>&amp;mtrim</code></a>. Removes the remaining whitespace from the mask.</li><li>Mask background <a href="/docs/mask.html#mask-background"><code>&amp;mbg</code></a>. Sets the background color of the mask.</li></ul><h3 id="flexible-uri-parser"><a href="#flexible-uri-parser" class="header-anchor">#</a> Flexible URI parser</h3><p>With API 4 we are supporting URI's starting with <code>http://</code> and <code>https://</code>. Previously this would result in
an error to prevent BBCode parsers to fail on the double <code>http(s)://</code>-part. Because Markdown is
increasingly becoming the standard for user input, we decided to make the URI parser more flexible.
Note that we will still support <code>?url=ssl:…</code> and <code>?url=//…</code>-requests for backwards compatibility.</p><h2 id="where-can-i-view-the-code"><a href="#where-can-i-view-the-code" class="header-anchor">#</a> Where can I view the code?</h2><p>The code is available on the <a href="https://github.com/weserv/images/tree/4.x" target="_blank" rel="noopener noreferrer">4.x branch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, this will become the default branch in the future.</p></div><footer class="page-edit"><!----><!----></footer><!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.46175f23.js" defer></script><script src="/assets/js/1.439f20f5.js" defer></script><script src="/assets/js/11.df7e7a8a.js" defer></script><script src="/assets/js/6.3fa32d31.js" defer></script>
  </body>
</html>
