<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Introducing API version 4 | wsrv.nl</title>
    <meta name="description" content="Image cache &amp; resize service">
    <link rel="stylesheet" href="/assets/style.a8488ad6.css">
    <link rel="modulepreload" href="/assets/chunks/AlgoliaSearchBox.b42c4a7a.js">
    <link rel="modulepreload" href="/assets/app.82b5f492.js">
    <link rel="modulepreload" href="/assets/news_2018_07_29_introducing-api-4.md.fa0d06fa.lean.js">
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#a72376">
  <meta name="msapplication-TileColor" content="#a72376">
  <meta name="theme-color" content="#ffffff">
  <meta name="twitter:title" content="Introducing API version 4 | wsrv.nl">
  <meta property="og:title" content="Introducing API version 4 | wsrv.nl">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="wsrv.nl, back to home" data-v-40587210 data-v-016a8bd8><img class="logo" src="/logo.svg" alt="Logo" data-v-016a8bd8> wsrv.nl</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/docs/" data-v-49fe041d>Documentation <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item active" href="/news/" data-v-49fe041d>News <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/faq/" data-v-49fe041d>FAQ <!----></a></div></div><!--]--><!----><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/weserv/docs" target="_blank" rel="noopener noreferrer" data-v-49fe041d>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/docs/" data-v-49fe041d>Documentation <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item active" href="/news/" data-v-49fe041d>News <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/faq/" data-v-49fe041d>FAQ <!----></a></div></div><!--]--><!----><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/weserv/docs" target="_blank" rel="noopener noreferrer" data-v-49fe041d>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><p class="sidebar-link-item">News</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/news/2019/09/01/introducing-api-5">Introducing API version 5</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/news/2018/07/29/introducing-api-4">Introducing API version 4</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#preface">Preface</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#openresty-luajit-and-lua-vips">OpenResty, LuaJIT and lua-vips</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#what-has-changed-for-the-end-user">What has changed for the end user?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#what-has-been-added">What has been added?</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#masking">Masking</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#flexible-uri-parser">Flexible URI parser</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#where-can-i-view-the-code">Where can I view the code?</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="introducing-api-version-4" tabindex="-1">Introducing API version 4 <a class="header-anchor" href="#introducing-api-version-4" aria-hidden="true">#</a></h1><h2 id="preface" tabindex="-1">Preface <a class="header-anchor" href="#preface" aria-hidden="true">#</a></h2><p>As the amount of traffic increases, we come up with solutions to handle the traffic. Nowadays we handle 2 million requests per hour (4 million on peak), which is great, but it requires proper server capacity and effective software that scales with the amount of traffic that make this service reliable.</p><h2 id="openresty-luajit-and-lua-vips" tabindex="-1">OpenResty, LuaJIT and lua-vips <a class="header-anchor" href="#openresty-luajit-and-lua-vips" aria-hidden="true">#</a></h2><p>With API version 4 we decided to rewrite to complete code base to Lua and switch to <a href="https://openresty.org/en/" target="_blank" rel="noopener noreferrer">OpenResty</a>, which turns <a href="https://nginx.org/" target="_blank" rel="noopener noreferrer">nginx</a> and <a href="https://luajit.org/luajit.html" target="_blank" rel="noopener noreferrer">LuaJIT</a> into a full-fledged scriptable web platform. For image handling and manipulation we still use the <a href="https://github.com/libvips/libvips" target="_blank" rel="noopener noreferrer">libvips</a> image processing library under the hood. We have only moved from the <a href="https://github.com/libvips/php-vips" target="_blank" rel="noopener noreferrer">PHP-binding</a> to the <a href="https://github.com/libvips/lua-vips" target="_blank" rel="noopener noreferrer">Lua binding</a>.</p><p>You may wonder why we did this; it&#39;s because OpenResty is robust, fast and scales with the amount of traffic we are processing nowadays. One of the core benefits of OpenResty is that it is fully asynchronous and that our code can be written directly inside Nginx without using PHP-FPM and FastCGI. The amazing just-in-time (JIT) compilation and the integrated foreign function interface (FFI) in LuaJIT have also been motives to move away from PHP.</p><p>Perhaps you&#39;ve already noticed, <a href="/">https://wsrv.nl/</a> already states that API version 4 is running. This is not a mistake, our A/B testing went so well that we decided (on time of writing) to forward all traffic to API version 4.</p><h2 id="what-has-changed-for-the-end-user" tabindex="-1">What has changed for the end user? <a class="header-anchor" href="#what-has-changed-for-the-end-user" aria-hidden="true">#</a></h2><p>Absolutely nothing, all parameters listed on API 3 still work on API 4. The only thing you might notice is when you process an image, that it will load faster. If you found something odd, don&#39;t hesitate to contact us.</p><p>We track support tickets, issues and feature requests using the <a href="https://github.com/weserv/images/issues" target="_blank" rel="noopener noreferrer">GitHub issue tracker</a>.</p><h2 id="what-has-been-added" tabindex="-1">What has been added? <a class="header-anchor" href="#what-has-been-added" aria-hidden="true">#</a></h2><p>We introduced some new parameters and a more flexible URI parser.</p><h3 id="masking" tabindex="-1">Masking <a class="header-anchor" href="#masking" aria-hidden="true">#</a></h3><p>Controls the visible and non-visible area of the image. Previously the <a href="/docs/mask.html#mask-type"><code>&amp;mask</code></a> and <a href="/docs/mask.html#mask-trim"><code>&amp;mtrim</code></a> parameter were named as <code>&amp;shape</code> and <code>&amp;strim</code>, it was renamed to make room for new mask features.</p><ul><li>Mask type <a href="/docs/mask.html#mask-type"><code>&amp;mask</code></a>. Sets the mask type from a predefined list of shapes: <ul><li><code>circle</code></li><li><code>ellipse</code></li><li><code>triangle</code></li><li><code>triangle-180</code>: Triangle tilted upside down</li><li><code>pentagon</code></li><li><code>pentagon-180</code>: Pentagon tilted upside down</li><li><code>hexagon</code></li><li><code>square</code>: Square tilted 45 degrees</li><li><code>star</code>: 5-point star</li><li><code>heart</code></li></ul></li><li>Mask trim <a href="/docs/mask.html#mask-trim"><code>&amp;mtrim</code></a>. Removes the remaining whitespace from the mask.</li><li>Mask background <a href="/docs/mask.html#mask-background"><code>&amp;mbg</code></a>. Sets the background color of the mask.</li></ul><h3 id="flexible-uri-parser" tabindex="-1">Flexible URI parser <a class="header-anchor" href="#flexible-uri-parser" aria-hidden="true">#</a></h3><p>With API 4 we are supporting URI&#39;s starting with <code>http://</code> and <code>https://</code>. Previously this would result in an error to prevent BBCode parsers to fail on the double <code>http(s)://</code>-part. Because Markdown is increasingly becoming the standard for user input, we decided to make the URI parser more flexible. Note that we will still support <code>?url=ssl:…</code> and <code>?url=//…</code>-requests for backwards compatibility.</p><h2 id="where-can-i-view-the-code" tabindex="-1">Where can I view the code? <a class="header-anchor" href="#where-can-i-view-the-code" aria-hidden="true">#</a></h2><p>The code is available on the <a href="https://github.com/weserv/images/tree/4.x" target="_blank" rel="noopener noreferrer">4.x branch</a>, this will become the default branch in the future.</p></div></div><footer class="page-footer" data-v-8fcebc32 data-v-b65b4b36><div class="edit" data-v-b65b4b36><div class="edit-link" data-v-b65b4b36 data-v-55695e90><!----></div></div><div class="updated" data-v-b65b4b36><!----></div></footer><div class="next-and-prev-link" data-v-8fcebc32 data-v-e65a9748><div class="container" data-v-e65a9748><div class="prev" data-v-e65a9748><a class="link" href="/news/2019/09/01/introducing-api-5" data-v-e65a9748><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-e65a9748><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-e65a9748>Introducing API version 5</span></a></div><div class="next" data-v-e65a9748><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"404.md\":\"07568049\",\"docs_adjustment.md\":\"8d7bdc4d\",\"docs_crop.md\":\"759765f0\",\"docs_fit.md\":\"e2c3a64e\",\"docs_format.md\":\"a0a8b676\",\"docs_index.md\":\"4b6f7b4f\",\"docs_mask.md\":\"20e2a11f\",\"docs_orientation.md\":\"bab88900\",\"docs_quick-reference.md\":\"52fdbf6d\",\"docs_size.md\":\"63b4d78a\",\"docs_supported-colors.md\":\"b252deff\",\"faq_index.md\":\"4e06a57c\",\"index.md\":\"b2b36b41\",\"news_2018_07_29_introducing-api-4.md\":\"fa0d06fa\",\"news_2019_09_01_introducing-api-5.md\":\"95a17d61\",\"news_index.md\":\"4579ed97\"}")</script>
    <script type="module" async src="/assets/app.82b5f492.js"></script>
    
  </body>
</html>